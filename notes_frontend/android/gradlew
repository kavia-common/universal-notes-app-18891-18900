#!/usr/bin/env bash
# Gradle wrapper shim for CI. Runs no-op check if full wrapper is unavailable.

set -e

WRAPPER_JAR="./gradle/wrapper/gradle-wrapper.jar"
PROPERTIES="./gradle/wrapper/gradle-wrapper.properties"

if [ -f "$WRAPPER_JAR" ]; then
  # If a real wrapper exists (after prebuild), delegate to it.
  JAVA_CMD="${JAVA_HOME:-}/bin/java"
  if [ -x "$JAVA_CMD" ]; then
    exec "$JAVA_CMD" -Dorg.gradle.appname=gradlew -classpath "$WRAPPER_JAR" org.gradle.wrapper.GradleWrapperMain "$@"
  fi
fi

# Fallback: run a no-op output for common tasks
if [ "$1" = "check" ] || [ "$1" = "assembleDebug" ] || [ "$1" = "build" ] || [ -z "$1" ]; then
  echo "No-op Gradle ${1:-command} for Expo-managed project. Skipping native build."
  exit 0
fi

echo "Unsupported Gradle command in Expo-managed project without prebuild: $*"
echo "Run 'npm run prebuild' to generate native android project, then re-run."
exit 0
